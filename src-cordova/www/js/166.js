"use strict";(self["webpackChunkclipbroad"]=self["webpackChunkclipbroad"]||[]).push([[166],{166:(t,e,i)=>{i.r(e),i.d(e,{default:()=>_});var a=i(3673),o=i(8880),n=i(2323);const s=["src"];function l(t,e,i,l,r,h){const d=(0,a.up)("q-icon"),c=(0,a.up)("q-item-section"),p=(0,a.up)("q-item-label"),u=(0,a.up)("q-item"),m=(0,a.up)("q-list"),g=(0,a.up)("q-page"),f=(0,a.up)("q-pull-to-refresh"),b=(0,a.Q2)("ripple");return(0,a.wg)(),(0,a.j4)(f,{onRefresh:t.syncNow,color:"black",icon:"autorenew"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{class:"q-pa-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{bordered:"",separator:""},{default:(0,a.w5)((()=>[(0,a.Wm)(o.W3,{appear:"","enter-active-class":"animated slideInLeft","leave-active-class":"animated fadeOutLeft"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.items,((e,i)=>(0,a.wy)(((0,a.wg)(),(0,a.j4)(u,{key:i,clickable:"",onDblclick:e=>t.copyItem(i)},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{color:"primary",name:t.itemIcon(e.type)},null,8,["name"])])),_:2},1024),"text"==e.type?((0,a.wg)(),(0,a.j4)(c,{key:0},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{lines:"3"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(e.value),1)])),_:2},1024)])),_:2},1024)):(0,a.kq)("",!0),"png"==e.type?((0,a.wg)(),(0,a.j4)(c,{key:1},{default:(0,a.w5)((()=>[(0,a._)("img",{src:"data:image/png;base64,"+e.value,style:{"max-height":"300px","object-fit":"contain","max-width":"100%"}},null,8,s)])),_:2},1024)):(0,a.kq)("",!0),(0,a.Wm)(c,{side:""},{default:(0,a.w5)((()=>[(0,a.Wm)(p,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(t.prevTime(e.time)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onDblclick"])),[[b]]))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["onRefresh"])}var r=i(515),h=i.n(r),d=(i(7280),i(7874)),c=i(19),p=i(5814)["Buffer"];const u=i(3559),m=500;var g=[],f=!1,b=!1,w=0;const I=(0,a.aZ)({computed:h()(h()({},(0,d.rn)("clipboard",["items"])),(0,d.Se)("clipboard",["lastLocalItem"])),methods:h()(h()({},(0,d.nv)("clipboard",["addItem","filterItem","removeItem","setItemUploaded"])),{},{checkClipboard(){if(this.$q.platform.is.electron){const t=window.myAPI.readClipboardImage();if(null==t){const t=window.myAPI.readClipboardText();this.addItemInternal(t,"text")}else this.addItemInternal(t,"png")}else this.$q.platform.is.capacitor?Clipboard.read().then((t=>{"text/plain"==t.type&&this.addItemInternal(t.value,"text")})):this.$q.platform.is.cordova&&cordova.plugins.clipboard.paste((t=>{this.addItemInternal(t,"text")}))},prevTime(t){const e=(new Date).getTime(),i=parseInt((e-t)/1e3);if(i<=0)return"Right Now";if(i<60)return i.toString()+"s ago";if(i<3600){const t=parseInt(i/60);return t.toString()+"m ago"}if(i<86400){const t=parseInt(i/3600);return t.toString()+"h ago"}{const t=parseInt(i/3600/24);return t.toString()+"d ago"}},itemIcon(t){switch(t){case"text":return"text_fields";case"png":return"image";default:return"text_fields"}},copyItem(t){const e=this.items[t];switch(e.type){case"text":this.removeItem(t),e.time=(new Date).getTime(),e.uploaded=!1,this.addItem(e),this.$q.platform.is.electron?(window.myAPI.writeClipboardText(e.value),!0===this.$q.localStorage.getItem("clipbroad-show-copied-notification")&&window.myAPI.showNotification(this.$t("copied"),e.value),window.myAPI.hideWindow()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(e.value),this.$q.notify(this.$t("copied")));break;case"png":this.$q.platform.is.electron?(window.myAPI.writeClipboardImage(e.value),!0===this.$q.localStorage.getItem("clipbroad-show-copied-notification")&&window.myAPI.showNotification(this.$t("copied")),window.myAPI.hideWindow()):this.$q.platform.is.cordova&&window.plugins.socialsharing.shareWithOptions({files:["data:image/png;base64,"+e.value]},null,(t=>{this.$q.notify(t)}));break;default:break}},setDarkMode(){if(this.$q.platform.is.electron){const t=window.myAPI.isDarkMode();this.$q.dark.set(t)}},isCellular(){if(this.$q.platform.is.electron)return!1;var t=navigator.connection.type;return!![Connection.CELL_2G,Connection.CELL_3G,Connection.CELL_4G,Connection.CELL].includes(t)},isConnected(){if(this.$q.platform.is.electron)return!0;var t=navigator.connection.type;return t!=Connection.NONE},shouldSync(){return this.$githubInstance.githubRepoExist?this.isConnected()?!0===this.$q.localStorage.getItem("clipbroad-use-mobile-data")||!this.isCellular()||(this.$q.notify(this.$t("syncUntilWifi")),!1):(this.$q.notify(this.$t("noNetwork")),!1):(c.log("github repo does not exist"),!1)},updateFromGithub(){this.shouldSync()&&(this.$q.notify(this.$t("updating")),this.$githubInstance.githubRepo.getContents("main","",!0).then((({data:t})=>{w=Math.max(t.length-m,0);const e=this.$q.localStorage.has("clipbroad-max-item")?this.$q.localStorage.getItem("clipbroad-max-item"):20;var i=0;for(let o=t.length-1;o>=Math.max(0,t.length-m);o--)(a=>{if(i>=e)return;let o=t[a].name;o=o.split(".");let n=o[0].split("-");if(n.length<2)return;let s=o.length<2?"text":o[1],l=parseInt(n[0]),r=n[1],h=this.items.find((t=>t.md5==n[1]));if(null!=h&&h.time>l)return;i++;let d=t[a].sha,c="text"==s;this.$githubInstance.githubRepo.getBlob(d,c).then((({data:t})=>{let e="text"==s?t:t.content;this.filterItem(r),this.addItem({time:l,md5:r,uploaded:!0,value:e,type:s,source:"remote"})}))})(o);if(w<=0)return;let a=[];for(let o=0;o<w;o++)a.push({path:t[o].path,sha:null,mode:"100644",type:"blob"});this.uploadTree(a).then((()=>{w=0,c.log("delete complete")})).catch((t=>{c.log(t)}))})))},uploadToGithub(){return new Promise(((t,e)=>{if(!this.shouldSync())return void t();c.log("uploading to github");let i=[],a=[];for(let n=0;n<this.items.length;n++)this.items[n].uploaded||""==this.items[n].value||(a.push(this.items[n]),this.setItemUploaded(n));if(a.length<=0)return c.log("no item to upload"),void t();for(var o=0;o<a.length;o++)(o=>{let n=a[o].time.toString()+"-"+a[o].md5,s=a[o].value;switch(a[o].type){case"png":n+=".png",s=p.from(s,"base64");break;default:n+="-text";break}this.$githubInstance.githubRepo.createBlob(s).then((({data:o})=>{i.push({sha:o.sha,path:n,mode:"100644",type:"blob"}),i.length==a.length&&this.uploadTree(i).then((()=>{this.$q.notify(this.$t("uploaded")),t()})).catch((t=>{this.$q.notify(t),e(t)}))})).catch((t=>{this.$q.notify(t),e(t)}))})(o)}))},uploadTree(t){return new Promise(((e,i)=>{let a;this.getSha().then((t=>{a=t})).then((()=>this.$githubInstance.githubRepo.createTree(t,a.commit))).then((({data:t})=>this.$githubInstance.githubRepo.commit(a.parent,t.sha,"update"))).then((({data:t})=>{this.$githubInstance.githubRepo.updateHead("heads/main",t.sha,!0)})).then((()=>{e()})).catch((t=>{i(t)}))}))},getSha(){return new Promise(((t,e)=>{let i,a;this.$githubInstance.githubRepo.getRef("heads/main").then((({data:t})=>{i=t.object.sha})).then((()=>this.$githubInstance.githubRepo.getCommit(i))).then((({data:e})=>(a=e.tree.sha,t({parent:i,commit:a})))).catch((t=>e(t)))}))},resetTimer(){g.forEach(((t,e)=>{clearInterval(t)})),g=[];const t=setInterval(this.checkClipboard,500),e=setInterval(this.uploadToGithub,3e4);g.push(t),g.push(e)},syncNow(t){this.$githubInstance.githubRepoExist?this.uploadToGithub().then((()=>{this.updateFromGithub(),setTimeout(t,1e3)})):this.$router.push("/settings")},setupOpenwith(){cordova.openwith.init((()=>{cordova.openwith.addHandler((t=>{for(var e=0;e<t.items.length;++e){var i=t.items[e];cordova.openwith.load(i,((e,i)=>{i.type.includes("image/")?this.addItemInternal(e,"png","share"):this.$q.notify(this.$t("fileTypeNotSupported")),t.exit&&cordova.openwith.exit()}))}})),b=!0}),(()=>{c.log("openwith plugin init failed")}))},addItemInternal(t,e,i="local"){const a=u.hash(t);""!=t&&(this.items.length<1||null!=this.lastLocalItem&&this.lastLocalItem.md5!=a)&&(this.filterItem(a),this.addItem({time:(new Date).getTime(),value:t,md5:a,uploaded:!1,type:e,source:i}))}}),mounted(){this.$q.localStorage.has("clipbroad-github-token")&&this.$setGithub(this.$q.localStorage.getItem("clipbroad-github-token")).then((()=>{this.updateFromGithub()})).catch((()=>{})),this.resetTimer()},created(){this.$i18n.locale=this.$q.lang.getLocale(),this.setDarkMode(),f||(window.addEventListener("Sync",this.syncNow,!1),f=!0);let t=!this.$q.localStorage.has("clipbroad-hide-icon")||this.$q.localStorage.getItem("clipbroad-hide-icon");this.$q.platform.is.electron&&window.myAPI.setHideIcon(t),this.$q.platform.is.cordova&&(b||this.setupOpenwith()),this.resetTimer()}});var $=i(3720),v=i(4379),y=i(7011),q=i(3414),k=i(2035),x=i(4554),C=i(2350),S=i(6489),T=i(9789),L=i.n(T);I.render=l;const _=I;L()(I,"components",{QPullToRefresh:$.Z,QPage:v.Z,QList:y.Z,QItem:q.Z,QItemSection:k.Z,QIcon:x.Z,QItemLabel:C.Z}),L()(I,"directives",{Ripple:S.Z})}}]);