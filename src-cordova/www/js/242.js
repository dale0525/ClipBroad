"use strict";(self["webpackChunkclipbroad"]=self["webpackChunkclipbroad"]||[]).push([[242],{3242:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ee});var l=i(3673),o=i(8880),a=i(2323);const n=(0,l._)("br",null,null,-1),s=(0,l._)("br",null,null,-1),r=(0,l._)("br",null,null,-1),h=(0,l._)("br",null,null,-1),d=(0,l._)("br",null,null,-1),u=(0,l._)("br",null,null,-1),c=(0,l._)("br",null,null,-1),m=(0,l._)("br",null,null,-1),p={key:0,class:"absolute-bottom-left"},g={class:"absolute-bottom-right"};function f(e,t,i,f,b,w){const y=(0,l.up)("q-tooltip"),I=(0,l.up)("q-checkbox"),v=(0,l.up)("q-item-section"),$=(0,l.up)("q-icon"),q=(0,l.up)("ClipboardItem"),k=(0,l.up)("q-item-label"),S=(0,l.up)("q-item"),N=(0,l.up)("q-list"),x=(0,l.up)("q-btn"),_=(0,l.up)("q-toolbar"),P=(0,l.up)("q-page"),C=(0,l.up)("q-pull-to-refresh"),A=(0,l.Q2)("ripple"),D=(0,l.Q2)("touch-hold");return(0,l.wg)(),(0,l.j4)(C,{onRefresh:e.syncNow,color:"black",icon:"autorenew"},{default:(0,l.w5)((()=>[(0,l.Wm)(P,{class:"q-pa-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(N,{bordered:"",separator:""},{default:(0,l.w5)((()=>[(0,l.Wm)(o.W3,{appear:"","enter-active-class":"animated slideInLeft","leave-active-class":"animated fadeOutLeft"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.items,((i,o)=>(0,l.wy)(((0,l.wg)(),(0,l.j4)(S,{key:o,clickable:"",onDblclick:t=>e.copyItem(o)},{default:(0,l.w5)((()=>[e.showItemDebugInfo?((0,l.wg)(),(0,l.j4)(y,{key:0},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(i.time),1),n,(0,l.Uk)(" "+(0,a.zw)(i.value.toString().substr(0,100)),1),s,(0,l.Uk)(" "+(0,a.zw)(i.isBuffer),1),r,(0,l.Uk)(" "+(0,a.zw)(i.md5),1),h,(0,l.Uk)(" "+(0,a.zw)(i.uploaded),1),d,(0,l.Uk)(" "+(0,a.zw)(i.type),1),u,(0,l.Uk)(" "+(0,a.zw)(null==i.fileName?"N/A":i.fileName),1),c,(0,l.Uk)(" "+(0,a.zw)(null==i.remotePath?"N/A":i.remotePath),1),m,(0,l.Uk)(" "+(0,a.zw)(null==i.remoteSha?"N/A":i.remoteSha),1)])),_:2},1024)):(0,l.kq)("",!0),e.actionBtn?((0,l.wg)(),(0,l.j4)(v,{key:1,avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{modelValue:e.toDeleteItems,"onUpdate:modelValue":t[0]||(t[0]=t=>e.toDeleteItems=t),val:o,color:"orange",onClick:t[1]||(t[1]=()=>{e.toDeleteItems.length==e.items.length?e.isAllSelected=!0:0==e.toDeleteItems.length?e.isAllSelected=!1:e.isAllSelected=null})},null,8,["modelValue","val"])])),_:2},1024)):(0,l.kq)("",!0),(0,l.Wm)(v,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)($,{color:"primary",name:e.itemIcon(i.type)},null,8,["name"])])),_:2},1024),(0,l.Wm)(q,{type:i.type,value:i.value.toString(),key:i.md5,fileName:i.fileName},null,8,["type","value","fileName"]),(0,l.Wm)(v,{side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.prevTime(i.time)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onDblclick"])),[[A],[D,()=>{e.toggleActionBtn(!0)},"500",{mouse:!0}]]))),128))])),_:1})])),_:1}),e.actionBtn?((0,l.wg)(),(0,l.j4)(_,{key:0,class:"fixed-bottom bg-primary"},{default:(0,l.w5)((()=>[e.actionBtn?((0,l.wg)(),(0,l.iD)("div",p,[(0,l.Wm)(v,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{"keep-color":"","indeterminate-value":null,size:"xl",class:"q-mx-lg",modelValue:e.isAllSelected,"onUpdate:modelValue":t[2]||(t[2]=t=>e.isAllSelected=t),color:"orange",onClick:t[3]||(t[3]=t=>e.selectAll())},null,8,["modelValue"])])),_:1})])):(0,l.kq)("",!0),(0,l._)("div",g,[e.showDeleteBtn?((0,l.wg)(),(0,l.j4)(x,{key:0,fab:"",icon:"delete",color:"orange",class:"q-ma-md",onClick:t[4]||(t[4]=t=>e.deleteSelected())})):(0,l.kq)("",!0),(0,l.Wm)(x,{fab:"",icon:"close",color:"primary",class:"q-ma-md",onClick:t[5]||(t[5]=()=>{e.toDeleteItems=[],e.toggleActionBtn(!1),e.isAllSelected=!1})})])])),_:1})):(0,l.kq)("",!0)])),_:1})])),_:1},8,["onRefresh"])}var b=i(515),w=i.n(b);i(7280),i(5363),i(7098);const y=["src"],I=["src"];function v(e,t,i,o,n,s){const r=(0,l.up)("q-item-label"),h=(0,l.up)("q-item-section");return(0,l.wg)(),(0,l.iD)(l.HY,null,["txt"==e.type?((0,l.wg)(),(0,l.j4)(h,{key:0},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{lines:"3"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.value),1)])),_:1})])),_:1})):(0,l.kq)("",!0),"html"==e.type?((0,l.wg)(),(0,l.j4)(h,{key:1},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{lines:"3",innerHTML:e.value},null,8,["innerHTML"])])),_:1})):(0,l.kq)("",!0),"png"==e.type?((0,l.wg)(),(0,l.j4)(h,{key:2},{default:(0,l.w5)((()=>[(0,l._)("img",{src:"data:image/png;base64,"+e.value,style:{"max-height":"300px","object-fit":"contain","max-width":"100%"}},null,8,y)])),_:1})):(0,l.kq)("",!0),"gif"==e.type?((0,l.wg)(),(0,l.j4)(h,{key:3},{default:(0,l.w5)((()=>[(0,l._)("img",{src:"data:image/gif;base64,"+e.value,style:{"max-height":"300px","object-fit":"contain","max-width":"100%"}},null,8,I)])),_:1})):(0,l.kq)("",!0),"png"!=e.type&&"txt"!=e.type&&"html"!=e.type&&"gif"!=e.type?((0,l.wg)(),(0,l.j4)(h,{key:4,class:"rounded-borders text-center bg-green"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.fileName+"."+e.type),1)])),_:1})):(0,l.kq)("",!0)],64)}const $=(0,l.aZ)({name:"ClipboardItem",props:{type:{type:String,required:!0},value:{type:String,required:!0},fileName:{type:String,required:!1}}});var q=i(2035),k=i(2350),S=i(9789),N=i.n(S);$.render=v;const x=$;N()($,"components",{QItemSection:q.Z,QItemLabel:k.Z});var _=i(7874),P=i(2841),C=i(19),A=i(5814)["Buffer"];const D=i(3559),T=i(2361),B=500;var W=[],Z=!1,L=!1,R=0,j=!1,z=!1,U=[];const Q=(0,l.aZ)({components:{ClipboardItem:x},data(){return{toDeleteItems:[],isAllSelected:!1,showItemDebugInfo:!1}},computed:w()(w()(w()({},(0,_.rn)("clipboard",["items","actionBtn"])),(0,_.Se)("clipboard",["lastNonShareItem"])),{},{showDeleteBtn(){return this.toDeleteItems.length>0}}),methods:w()(w()({},(0,_.nv)("clipboard",["addItem","updateRemoteParam","removeItem","setItemUploaded","toggleActionBtn"])),{},{checkClipboard(){if(this.$q.platform.is.electron){const e=window.myAPI.readClipboard(this.$q.localStorage.has("clipbroad-max-file-size")?this.$q.localStorage.getItem("clipbroad-max-file-size"):5);if(null==e)return;this.addNewItem(null,e.value,!0,null,!1,e.type,e.fileName,null,null)}else this.$q.platform.is.cordova&&cordova.plugins.clipboard.paste((e=>{null!=e&&""!=e&&this.addNewItem(null,e.toString(),!0,null,!1,"txt",null,null,null)}))},prevTime(e){const t=(new Date).getTime(),i=parseInt((t-e)/1e3);if(i<=0)return"Right Now";if(i<60)return i.toString()+"s ago";if(i<3600){const e=parseInt(i/60);return e.toString()+"m ago"}if(i<86400){const e=parseInt(i/3600);return e.toString()+"h ago"}{const e=parseInt(i/3600/24);return e.toString()+"d ago"}},itemIcon(e){switch(e){case"txt":return"subject";case"png":return"image";case"html":return"code";case"pdf":return"picture_as_pdf";case"gif":return"gif_box";case"zip":case"7z":case"rar":case"tar":return"archive";case"xlsx":case"xls":case"xlsm":return"table_view";case"doc":case"docx":return"text_snippet";case"txt":return"text_fields";default:return"attachment"}},copyItem(e){const t=this.items[e];switch(t.type){case"txt":this.$q.platform.is.electron?(window.myAPI.writeClipboardText(t.value),!0===this.$q.localStorage.getItem("clipbroad-show-copied-notification")&&window.myAPI.showNotification(this.$t("copied"),t.value),window.myAPI.hideWindow()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(t.value),this.$q.notify(this.$t("copied")));break;case"html":var i=document.createElement("div");i.innerHTML=t.value;var l=i.textContent||i.innerText||"";this.$q.platform.is.electron?(window.myAPI.writeClipboardHTML(l),!0===this.$q.localStorage.getItem("clipbroad-show-copied-notification")&&window.myAPI.showNotification(this.$t("copied"),l),window.myAPI.hideWindow()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(l),this.$q.notify(this.$t("copied")));break;case"png":this.$q.platform.is.electron?(window.myAPI.writeClipboardImage(t.value),!0===this.$q.localStorage.getItem("clipbroad-show-copied-notification")&&window.myAPI.showNotification(this.$t("copied")),window.myAPI.hideWindow()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(""),window.plugins.socialsharing.shareWithOptions({files:["data:image/png;base64,"+t.value]},(()=>{}),(e=>{this.$q.notify(e)})));break;case"gif":this.$q.platform.is.electron?(fetch("data:image/gif;base64,"+t.value).then((e=>e.blob())).then((e=>{(0,P.Z)(t.fileName+"."+t.type,e)})).catch((e=>{C.log(e)})),window.myAPI.clearClipboard()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(""),window.plugins.socialsharing.shareWithOptions({files:["data:image/gif;base64,"+t.value]},(()=>{}),(e=>{this.$q.notify(e)})));break;default:if(this.$q.platform.is.electron)t.isBuffer?(0,P.Z)(t.fileName+"."+t.type,A.from(t.value,"base64")):fetch(t.value).then((e=>e.blob())).then((e=>{(0,P.Z)(t.fileName+"."+t.type,e)})).catch((e=>{C.log(e)})),window.myAPI.clearClipboard();else if(this.$q.platform.is.cordova){const e=T.getType(t.type);if(!e)return void this.$q.notify(this.$t("fileTypeNotSupported"));cordova.plugins.clipboard.copy(""),window.plugins.socialsharing.shareWithOptions({subject:t.fileName,files:[t.isBuffer?"data:"+e+";base64,"+t.value:t.value]},(()=>{}),(e=>{this.$q.notify(e)}))}break}this.addNewItem((new Date).getTime(),t.value,t.isBuffer,t.md5,t.uploaded,t.type,t.fileName,t.remotePath,t.remoteSha)},setDarkMode(){if(this.$q.platform.is.electron){const e=window.myAPI.isDarkMode();this.$q.dark.set(e)}},isCellular(){if(this.$q.platform.is.electron)return!1;var e=navigator.connection.type;return!![Connection.CELL_2G,Connection.CELL_3G,Connection.CELL_4G,Connection.CELL].includes(e)},isConnected(){if(this.$q.platform.is.electron)return!0;var e=navigator.connection.type;return e!=Connection.NONE},shouldSync(){return this.$githubInstance.githubRepoExist?this.isConnected()?!0===this.$q.localStorage.getItem("clipbroad-use-mobile-data")||!this.isCellular()||(this.$q.notify(this.$t("syncUntilWifi")),!1):(this.$q.notify(this.$t("noNetwork")),!1):(C.log("github repo does not exist"),!1)},updateFromGithub(){return new Promise(((e,t)=>{this.shouldSync()?z?t("Already updating"):(z=!0,C.log("updating..."),this.$githubInstance.githubRepo.getContents("main","",!0).then((({data:t})=>{if(t.length<2)return z=!1,void e();R=Math.max(t.length-B,0);const i=this.$q.localStorage.has("clipbroad-max-item")?this.$q.localStorage.getItem("clipbroad-max-item"):20,l=Math.min(i,t.length);let o=0;for(let a=t.length-1;a>=t.length-l;a--)(i=>{let a=t[i].name,n=a.split(".");if(n.length<2)return;let s=n[n.length-1],r=a.replace("."+s,"").split("-");if(r.length<2)return void o++;let h=parseInt(r[0]),d=r[1],u=null;r.length>2&&(u=a.replace("."+s,"").replace(r[0]+"-"+r[1]+"-","")),this.addNewItem(h,t[i].download_url,!0,d,!0,s,u,t[i].name,t[i].sha).then((()=>{o++,C.log(`${o}/${l}`),o==l&&(z=!1,C.log("updated"),e())}))})(a);if(!(R<=0))for(let e=0;e<R;e++)U.push({path:t[e].path,sha:null,mode:"100644",type:"blob"})})).catch((e=>{C.log(e),t(e)}))):e()}))},uploadToGithub(){return new Promise(((e,t)=>{if(!this.shouldSync())return void e();if(j)return C.log("still uploading..."),void e();j=!0;let i=[];for(let o=0;o<this.items.length;o++)this.items[o].uploaded||(i.push(this.items[o]),this.setItemUploaded(o));if(i.length<=0){if(U.length<=0)return C.log("no item to upload"),j=!1,void e();C.log(this.$t("uploading")),this.uploadTree(U).then((()=>{C.log(this.$t("uploaded")),U=[],j=!1,e()})).catch((e=>{C.log(e),this.$q.notify(this.$t("error")),j=!1,t(e)}))}else{C.log("uploading");let o=0;for(var l=0;l<i.length;l++)(l=>{let a=this.getItemPath(i[l]),n=i[l].value;switch(i[l].type){case"txt":case"html":break;default:n=A.from(n,"base64");break}this.$githubInstance.githubRepo.createBlob(n).then((({data:l})=>{U.push({sha:l.sha,path:a,mode:"100644",type:"blob"}),o++,o==i.length&&this.uploadTree(U).then((()=>{C.log("uploaded"),U=[],j=!1,e()})).catch((e=>{C.log(e),this.$q.notify(this.$t("error")),j=!1,t(e)}))})).catch((e=>{C.log(e),this.$q.notify(this.$t("error")),j=!1,t(e)}))})(l)}}))},uploadTree(e){return new Promise(((t,i)=>{if(e.length<1)return void t();let l;this.getSha().then((e=>{l=e})).then((()=>this.$githubInstance.githubRepo.createTree(e,l.commit))).then((({data:e})=>this.$githubInstance.githubRepo.commit(l.parent,e.sha,"update"))).then((({data:e})=>{this.$githubInstance.githubRepo.updateHead("heads/main",e.sha,!0)})).then((()=>{t()})).catch((e=>{C.log(e),i(e)}))}))},getSha(){return new Promise(((e,t)=>{let i,l;this.$githubInstance.githubRepo.getRef("heads/main").then((({data:e})=>{i=e.object.sha})).then((()=>this.$githubInstance.githubRepo.getCommit(i))).then((({data:t})=>(l=t.tree.sha,e({parent:i,commit:l})))).catch((e=>t(e)))}))},resetTimer(){W.forEach(((e,t)=>{clearInterval(e)})),W=[];const e=setInterval(this.checkClipboard,500),t=setInterval(this.syncNow,1e4);W.push(e),W.push(t)},syncNow(e){this.$githubInstance.githubRepoExist?this.updateFromGithub().then((()=>{this.uploadToGithub(),setTimeout(e,1e3)})):this.$router.push("/settings")},setupOpenwith(){cordova.openwith.init((()=>{cordova.openwith.addHandler((e=>{for(var t=0;t<e.items.length;++t){var i=e.items[t];cordova.openwith.load(i,((e,t)=>{const i=T.getExtension(t.type);if(i){var l=t.path;l=l.split("/");var o=l[l.length-1],a=o.split("."),n=o.replace("."+a[a.length-1],"");this.addNewItem(null,e,!0,null,!1,["jpg","png"].includes(i)?"png":i,n,null,null,!0)}}))}})),L=!0}),(()=>{C.log("openwith plugin init failed")}))},addNewItem(e,t,i,l,o,a,n,s,r,h=!1){return new Promise(((h,d)=>{if(null==l&&(l=D.hash(t)),null!=this.lastNonShareItem&&this.lastNonShareItem.md5==l)return void h();null==e&&(e=(new Date).getTime());let u=this.items.findIndex((e=>e.md5==l));if(u<0)if(null!=r)if(["txt","html","png","gif"].includes(a)){let t="txt"==a||"html"==a;this.$githubInstance.githubRepo.getBlob(r,t).then((({data:t})=>{let i="txt"==a||"html"==a?t:t.content;this.addItem({time:e,value:i,isBuffer:!0,md5:l,uploaded:o,type:a,fileName:n,remotePath:s,remoteSha:r}),h()}))}else this.addItem({time:e,value:t,isBuffer:!1,md5:l,uploaded:o,type:a,fileName:n,remotePath:s,remoteSha:r}),h();else this.addItem({time:e,value:t,isBuffer:i,md5:l,uploaded:o,type:a,fileName:n,remotePath:s,remoteSha:r}),h();else if(this.items[u].time==e)this.updateRemoteParam({index:u,remotePath:s,remoteSha:r}),h();else if(this.items[u].time>e)U.push({path:s,sha:null,mode:"100644",type:"blob"}),h();else{let o=this.items[u];if(this.removeItem(u),null!=o.remotePath){let s=this.getItemPath({time:e,md5:l,fileName:n,type:a});U.push({path:s,sha:o.remoteSha,mode:"100644",type:"blob"}),U.push({path:o.remotePath,sha:null,mode:"100644",type:"blob"}),this.addItem({time:e,value:t,isBuffer:i,md5:l,uploaded:!0,type:a,fileName:n,remotePath:s,remoteSha:o.remoteSha}),h()}else this.addItem({time:e,value:t,isBuffer:i,md5:l,uploaded:!1,type:a,fileName:n,remotePath:null,remoteSha:null}),h()}}))},getItemPath(e){let t=e.time.toString()+"-"+e.md5;return null!=e.fileName&&(t+="-"+e.fileName),t+="."+e.type,t},deleteSelected(e=!0){if(this.toDeleteItems.length>0){if(e&&this.$q.notify(this.$t("deleting")),j)return void setTimeout((()=>{this.deleteSelected(!1)}),1e3);this.toDeleteItems.sort((function(e,t){return e-t}));for(let e=0;e<this.toDeleteItems.length;e++)this.items[this.toDeleteItems[e]].uploaded&&U.push({sha:null,path:this.getItemPath(this.items[this.toDeleteItems[e]]),mode:"100644",type:"blob"});if(U.length>0)j=!0,this.uploadTree(U).then((()=>{for(let e=this.toDeleteItems.length-1;e>=0;e--)this.removeItem(this.toDeleteItems[e]);U=[],j=!1,this.$q.notify(this.$t("deleted"))})).catch((e=>{C.log(e),U=[],j=!1,this.$q.notify(this.$t("error"))}));else{for(let e=this.toDeleteItems.length-1;e>=0;e--)this.removeItem(this.toDeleteItems[e]);this.$q.notify(this.$t("deleted"))}}this.toggleActionBtn(!1),this.isAllSelected=!1},selectAll(){if(this.toDeleteItems=[],!0===this.isAllSelected)for(let e=0;e<this.items.length;e++)this.toDeleteItems.push(e)},initGithub(){this.$q.localStorage.has("clipbroad-github-token")&&(this.$q.notify(this.$t("connectingGithub")),this.$setGithub(this.$q.localStorage.getItem("clipbroad-github-token")).then((()=>{this.$q.notify(this.$t("connectedGithub")),this.$q.notify(this.$t("updating")),this.updateFromGithub().then((()=>{this.$q.notify(this.$t("updated")),this.resetTimer()}))})).catch((()=>{this.$q.notify(),setTimeout((()=>{this.initGithub()}),2e3)})))}}),mounted(){this.initGithub()},created(){this.$i18n.locale=this.$q.lang.getLocale(),this.setDarkMode(),Z||(window.addEventListener("Sync",this.syncNow,!1),Z=!0);let e=!this.$q.localStorage.has("clipbroad-hide-icon")||this.$q.localStorage.getItem("clipbroad-hide-icon");this.$q.platform.is.electron&&window.myAPI.setHideIcon(e),this.$q.platform.is.cordova&&(L||this.setupOpenwith())}});var G=i(3720),E=i(4379),H=i(7011),M=i(3414),O=i(8870),V=i(5735),F=i(4554),Y=i(9570),K=i(4607),J=i(6489),X=i(7281);Q.render=f;const ee=Q;N()(Q,"components",{QPullToRefresh:G.Z,QPage:E.Z,QList:H.Z,QItem:M.Z,QTooltip:O.Z,QItemSection:q.Z,QCheckbox:V.Z,QIcon:F.Z,QItemLabel:k.Z,QToolbar:Y.Z,QBtn:K.Z}),N()(Q,"directives",{Ripple:J.Z,TouchHold:X.Z})}}]);