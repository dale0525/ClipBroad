"use strict";(self["webpackChunkclipbroad"]=self["webpackChunkclipbroad"]||[]).push([[739],{27:(e,t,i)=>{i.d(t,{Z:()=>l});const l={imageExt:["png","jpg","jpeg","gif","svg","tiff","bmp","ico","webp"],videoExt:["mp4","mov","mkv","avi","wmv","rmvb","swf","flv","mpg","mpeg"],audioExt:["mp3","ape","flac","wav","aac","wma","ogg","mpga"],archieveExt:["zip","7z","rar"],excelExt:["xls","xlsx","xlsm"],wordExt:["doc","docx"],textExt:["txt","inf","rtf","json","yaml"],defaultSettings:{hideIcon:!1,autoLaunch:!1,showCopiedNotification:!0,syncUseMobileData:!1,maxItem:40,darkMode:"auto",maxFileSize:5,shortcut:["Control","Shift","V"]},githubClientID:"fa79756f53d8c0a88ddd",autoSyncInterval:3e4,checkClipboardInterval:500}},739:(e,t,i)=>{i.r(t),i.d(t,{default:()=>me});i(7280);var l=i(3673),o=i(8880),a=i(2323);const s=(0,l._)("br",null,null,-1),n=(0,l._)("br",null,null,-1),r=(0,l._)("br",null,null,-1),h=(0,l._)("br",null,null,-1),m=(0,l._)("br",null,null,-1),d=(0,l._)("br",null,null,-1),u=(0,l._)("br",null,null,-1),c=(0,l._)("br",null,null,-1),p={key:0,class:"absolute-bottom-left"},g={class:"absolute-bottom-right"};function f(e,t,i,f,w,b){const y=(0,l.up)("q-icon"),v=(0,l.up)("q-item"),I=(0,l.up)("q-input"),x=(0,l.up)("q-card"),$=(0,l.up)("q-spinner"),q=(0,l.up)("q-tooltip"),k=(0,l.up)("q-checkbox"),S=(0,l.up)("q-item-section"),N=(0,l.up)("ClipboardItem"),T=(0,l.up)("q-item-label"),E=(0,l.up)("q-list"),Z=(0,l.up)("q-btn"),C=(0,l.up)("q-toolbar"),_=(0,l.up)("q-pull-to-refresh"),D=(0,l.up)("q-page"),P=(0,l.Q2)("ripple"),A=(0,l.Q2)("touch-hold");return(0,l.wg)(),(0,l.j4)(D,{class:"q-pa-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{style:{position:"sticky",top:"0"},class:"z-top q-mb-md"},{default:(0,l.w5)((()=>[(0,l.Wm)(I,{standout:"",modelValue:e.search,"onUpdate:modelValue":t[1]||(t[1]=t=>e.search=t),maxlength:"50",debounce:"300",ref:"searchInput"},{prepend:(0,l.w5)((()=>[(0,l.Wm)(y,{name:"search"})])),append:(0,l.w5)((()=>[""!==e.search?((0,l.wg)(),(0,l.j4)(y,{key:0,name:"close",onClick:t[0]||(t[0]=t=>e.search="")})):(0,l.kq)("",!0)])),after:(0,l.w5)((()=>[(0,l.Wm)(v,{to:"/settings",clickable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{name:"settings",class:"absolute-center"})])),_:1})])),_:1},8,["modelValue"])])),_:1}),e.loading?((0,l.wg)(),(0,l.j4)($,{key:0,color:"primary",size:"5em",thickness:10,class:"fixed-center"})):(0,l.kq)("",!0),(0,l.Wm)(_,{onRefresh:e.syncNow,color:"black",icon:"autorenew"},{default:(0,l.w5)((()=>[e.filterItemIndex.length>0?((0,l.wg)(),(0,l.j4)(E,{key:0,bordered:"",separator:""},{default:(0,l.w5)((()=>[(0,l.Wm)(o.W3,{appear:"","enter-active-class":"animated slideInLeft","leave-active-class":"animated fadeOutLeft"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.filterItemIndex,(i=>(0,l.wy)(((0,l.wg)(),(0,l.j4)(v,{key:i,clickable:"",onDblclick:t=>e.copyItem(i)},{default:(0,l.w5)((()=>[e.showItemDebugInfo?((0,l.wg)(),(0,l.j4)(q,{key:0},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.items[i].time),1),s,(0,l.Uk)(" "+(0,a.zw)(e.items[i].value.toString().substr(0,100)),1),n,(0,l.Uk)(" "+(0,a.zw)(e.items[i].isBuffer),1),r,(0,l.Uk)(" "+(0,a.zw)(e.items[i].md5),1),h,(0,l.Uk)(" "+(0,a.zw)(e.items[i].uploaded),1),m,(0,l.Uk)(" "+(0,a.zw)(e.items[i].type),1),d,(0,l.Uk)(" "+(0,a.zw)(null==e.items[i].fileName?"N/A":e.items[i].fileName),1),u,(0,l.Uk)(" "+(0,a.zw)(null==e.items[i].remotePath?"N/A":e.items[i].remotePath),1),c,(0,l.Uk)(" "+(0,a.zw)(null==e.items[i].remoteSha?"N/A":e.items[i].remoteSha),1)])),_:2},1024)):(0,l.kq)("",!0),e.actionBtn?((0,l.wg)(),(0,l.j4)(S,{key:1,avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{modelValue:e.toDeleteItems,"onUpdate:modelValue":t[2]||(t[2]=t=>e.toDeleteItems=t),val:i,color:"orange",onClick:t[3]||(t[3]=()=>{e.toDeleteItems.length==e.items.length?e.isAllSelected=!0:0==e.toDeleteItems.length?e.isAllSelected=!1:e.isAllSelected=null})},null,8,["modelValue","val"])])),_:2},1024)):(0,l.kq)("",!0),(0,l.Wm)(S,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(y,{color:"primary",name:e.itemIcon(e.items[i].type)},null,8,["name"])])),_:2},1024),(0,l.Wm)(N,{type:e.items[i].type,value:e.items[i].value.toString(),key:e.items[i].md5,fileName:e.items[i].fileName},null,8,["type","value","fileName"]),(0,l.Wm)(S,{side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(T,{caption:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.prevTime(e.items[i].time)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onDblclick"])),[[P],[A,()=>{e.actionBtn=!0},"500",{mouse:!0}]]))),128))])),_:1})])),_:1})):(0,l.kq)("",!0),e.actionBtn?((0,l.wg)(),(0,l.j4)(C,{key:1,class:"fixed-bottom bg-primary"},{default:(0,l.w5)((()=>[e.actionBtn?((0,l.wg)(),(0,l.iD)("div",p,[(0,l.Wm)(S,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{"keep-color":"","indeterminate-value":null,size:"xl",class:"q-mx-lg",modelValue:e.isAllSelected,"onUpdate:modelValue":t[4]||(t[4]=t=>e.isAllSelected=t),color:"orange",onClick:t[5]||(t[5]=t=>e.selectAll())},null,8,["modelValue"])])),_:1})])):(0,l.kq)("",!0),(0,l._)("div",g,[e.showDeleteBtn?((0,l.wg)(),(0,l.j4)(Z,{key:0,fab:"",icon:"delete",color:"orange",class:"q-ma-md",onClick:t[6]||(t[6]=t=>e.deleteSelected())})):(0,l.kq)("",!0),(0,l.Wm)(Z,{fab:"",icon:"close",color:"primary",class:"q-ma-md",onClick:t[7]||(t[7]=()=>{e.toDeleteItems=[],e.actionBtn=!1,e.isAllSelected=!1})})])])),_:1})):(0,l.kq)("",!0)])),_:1},8,["onRefresh"])])),_:1})}var w=i(515),b=i.n(w);i(71),i(5363),i(7098);const y=["src"],v=["src"],I=["src"];function x(e,t,i,o,s,n){const r=(0,l.up)("q-item-label"),h=(0,l.up)("q-item-section");return(0,l.wg)(),(0,l.iD)(l.HY,null,["text"==e.type?((0,l.wg)(),(0,l.j4)(h,{key:0},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{class:"ellipsis-3-lines"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.value),1)])),_:1})])),_:1})):(0,l.kq)("",!0),e.textExt.includes(e.type)?((0,l.wg)(),(0,l.j4)(h,{key:1},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{class:"ellipsis-3-lines"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.base64ToString(e.value)),1)])),_:1})])),_:1})):(0,l.kq)("",!0),"html"==e.type?((0,l.wg)(),(0,l.j4)(h,{key:2},{default:(0,l.w5)((()=>[(0,l.Wm)(r,{class:"ellipsis-3-lines",innerHTML:e.value},null,8,["innerHTML"])])),_:1})):(0,l.kq)("",!0),e.imageExt.includes(e.type)?((0,l.wg)(),(0,l.j4)(h,{key:3},{default:(0,l.w5)((()=>[(0,l._)("img",{src:"data:"+e.getMimeType(e.type)+";base64,"+e.value,style:{"max-height":"300px","object-fit":"contain","max-width":"100%"}},null,8,y)])),_:1})):(0,l.kq)("",!0),e.videoExt.includes(e.type)?((0,l.wg)(),(0,l.j4)(h,{key:4},{default:(0,l.w5)((()=>[(0,l._)("video",{controls:"",src:"data:"+e.getMimeType(e.type)+";base64,"+e.value,height:"320",style:{"object-fit":"contain"}},null,8,v)])),_:1})):(0,l.kq)("",!0),e.audioExt.includes(e.type)?((0,l.wg)(),(0,l.j4)(h,{key:5},{default:(0,l.w5)((()=>[(0,l.Wm)(h,{avatar:""},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.fileName),1)])),_:1}),(0,l._)("audio",{controls:"",src:"data:"+e.getMimeType(e.type)+";base64,"+e.value,style:{"object-fit":"contain","max-width":"100%"}},null,8,I)])),_:1})):(0,l.kq)("",!0),["text","html"].concat(e.imageExt).concat(e.videoExt).concat(e.audioExt).concat(e.textExt).includes(e.type)?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(h,{key:6,class:"rounded-borders text-center bg-green ellipsis"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,a.zw)(e.fileName+(null==e.type?"":"."+e.type)),1)])),_:1}))],64)}var $=i(27),q=i(5814)["Buffer"];const k=i(2361),S=(0,l.aZ)({name:"ClipboardItem",props:{type:{type:String,required:!1},value:{type:String,required:!0},fileName:{type:String,required:!1}},data(){return{imageExt:$.Z.imageExt,videoExt:$.Z.videoExt,audioExt:$.Z.audioExt,textExt:$.Z.textExt}},methods:{getMimeType(e){return k.getType(e)},base64ToString(e){return q.from(e,"base64").toString("utf-8")}}});var N=i(2035),T=i(2350),E=i(9789),Z=i.n(E);S.render=x;const C=S;Z()(S,"components",{QItemSection:N.Z,QItemLabel:T.Z});var _=i(7874),D=i(2841),P=i(19),A=i(5814)["Buffer"];const z=i(3559),W=i(2361),j=500;var L=[],B=!1,U=!1,R=0,M=!1,Q=!1,G=[],F=[],H=null,V=null;const O=(0,l.aZ)({components:{ClipboardItem:C},data(){return{toDeleteItems:[],isAllSelected:!1,showItemDebugInfo:!1,maxFileSize:this.$q.localStorage.has("clipbroad-max-file-size")?this.$q.localStorage.getItem("clipbroad-max-file-size"):$.Z.defaultSettings.maxFileSize,maxItem:this.$q.localStorage.has("clipbroad-max-item")?this.$q.localStorage.getItem("clipbroad-max-item"):$.Z.defaultSettings.maxItem,loading:!1,search:"",actionBtn:!1}},computed:b()(b()(b()({},(0,_.rn)("clipboard",["items"])),(0,_.Se)("clipboard",["lastNonShareItem"])),{},{showDeleteBtn(){return this.toDeleteItems.length>0},filterItemIndex(){return this.items.length<1?[]:[...this.items.keys()].filter((e=>this.getSearchContent(e).toLowerCase().includes(this.search.toLowerCase())))}}),methods:b()(b()({},(0,_.nv)("clipboard",["addItem","updateRemoteParam","removeItem","setItemUploaded"])),{},{checkClipboard(){if(this.$q.platform.is.electron){const e=window.myAPI.readClipboard(this.maxFileSize);if(null==e)return;this.addNewItem(null,e.value,!0,null,!1,e.type,e.fileName,null,null)}else this.$q.platform.is.cordova&&cordova.plugins.clipboard.paste((e=>{null!=e&&""!=e&&this.addNewItem(null,e.toString(),!0,null,!1,"text",null,null,null)}))},prevTime(e){const t=(new Date).getTime(),i=parseInt((t-e)/1e3);if(i<=0)return"Right Now";if(i<60)return i.toString()+"s ago";if(i<3600){const e=parseInt(i/60);return e.toString()+"m ago"}if(i<86400){const e=parseInt(i/3600);return e.toString()+"h ago"}{const e=parseInt(i/3600/24);return e.toString()+"d ago"}},itemIcon(e){return"html"==e?"code":"pdf"==e?"picture_as_pdf":"apk"==e?"apps":"text"==e?"subject":$.Z.textExt.includes(e)?"text_fields":$.Z.imageExt.includes(e)?"image":$.Z.archieveExt.includes(e)?"archive":$.Z.excelExt.includes(e)?"table_view":$.Z.wordExt.includes(e)?"article":$.Z.videoExt.includes(e)?"movie":$.Z.audioExt.includes(e)?"audiotrack":"attachment"},copyItem(e){const t=this.items[e];if("text"==t.type)this.$q.platform.is.electron?(window.myAPI.writeClipboardText(t.value),!0===this.$q.localStorage.getItem("clipbroad-show-copied-notification")&&window.myAPI.showNotification(this.$t("copied"),t.value),window.myAPI.hideWindow()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(t.value),this.$q.notify(this.$t("copied")));else if("html"==t.type){var i=this.getTextFromHtml(t.value);this.$q.platform.is.electron?(window.myAPI.writeClipboardHTML(t.value,i),!0===this.$q.localStorage.getItem("clipbroad-show-copied-notification")&&window.myAPI.showNotification(this.$t("copied"),i),window.myAPI.hideWindow()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(i),this.$q.notify(this.$t("copied")))}else if("gif"==t.type)this.$q.platform.is.electron?(fetch("data:image/gif;base64,"+t.value).then((e=>e.blob())).then((e=>{(0,D.Z)(t.fileName+"."+t.type,e)})).catch((e=>{P.log(e)})),window.myAPI.clearClipboard()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(""),window.plugins.socialsharing.shareWithOptions({files:["data:image/gif;base64,"+t.value]},(()=>{}),(e=>{this.$q.notify(e)})));else if($.Z.imageExt.includes(t.type))this.$q.platform.is.electron?(window.myAPI.writeClipboardImage(t.value),!0===this.$q.localStorage.getItem("clipbroad-show-copied-notification")&&window.myAPI.showNotification(this.$t("copied")),window.myAPI.hideWindow()):this.$q.platform.is.cordova&&(cordova.plugins.clipboard.copy(""),window.plugins.socialsharing.shareWithOptions({files:["data:"+W.getType(t.type)+";base64,"+t.value]},(()=>{}),(e=>{this.$q.notify(e)})));else if(this.$q.platform.is.electron)t.isBuffer?(0,D.Z)(null==t.type?t.fileName:t.fileName+"."+t.type,A.from(t.value,"base64")):(this.loading=!0,fetch(t.value).then((e=>e.blob())).then((e=>{this.loading=!1,(0,D.Z)(null==t.type?t.fileName:t.fileName+"."+t.type,e)})).catch((e=>{P.log(e)}))),window.myAPI.clearClipboard();else if(this.$q.platform.is.cordova){if(null==t.type)return void this.$q.notify(this.$t("fileTypeNotSupported"));const e=W.getType(t.type);if(!e)return void this.$q.notify(this.$t("fileTypeNotSupported"));cordova.plugins.clipboard.copy(""),window.plugins.socialsharing.shareWithOptions({subject:t.fileName,files:[t.isBuffer?"data:"+e+";base64,"+t.value:t.value]},(()=>{}),(e=>{this.$q.notify(e)}))}this.addNewItem((new Date).getTime(),t.value,t.isBuffer,t.md5,t.uploaded,t.type,t.fileName,t.remotePath,t.remoteSha)},setDarkMode(){const e=this.$q.localStorage.has("clipbroad-dark-mode")?this.$q.localStorage.getItem("clipbroad-dark-mode"):$.Z.defaultSettings.darkMode;this.$q.dark.set(e),this.$q.dark.toggle()},isCellular(){if(this.$q.platform.is.electron)return!1;var e=navigator.connection.type;return!![Connection.CELL_2G,Connection.CELL_3G,Connection.CELL_4G,Connection.CELL].includes(e)},isConnected(){if(this.$q.platform.is.electron)return!0;var e=navigator.connection.type;return e!=Connection.NONE},shouldSync(){return this.$githubInstance.githubRepoExist?this.isConnected()?!0===this.$q.localStorage.getItem("clipbroad-use-mobile-data")||!this.isCellular()||(this.$q.notify(this.$t("syncUntilWifi")),!1):(this.$q.notify(this.$t("noNetwork")),!1):(P.log("github repo does not exist"),!1)},updateFromGithub(){return new Promise(((e,t)=>{if(!this.shouldSync())return P.log("will not sync due to network settings"),void e();Q?t("Already updating"):(Q=!0,P.log("updating..."),H=setTimeout((()=>{Q=!1}),12e4),this.$githubInstance.githubRepo.getContents("main","",!0).then((({data:t})=>{if(t.length<2)return Q=!1,clearTimeout(H),void e();R=Math.max(t.length-j,0);const i=Math.min(this.maxItem,t.length);let l=0;for(let o=t.length-1;o>=t.length-i;o--)(o=>{let a=t[o].name,s=a.split("."),n=null;s.length>1&&(n=s[s.length-1]);let r=null==n?a.split("-"):a.replace("."+n,"").split("-");if(r.length<2)return void l++;let h=parseInt(r[0]),m=r[1];if(F.includes(m))return void l++;let d=null;r.length>2&&(d=a.replace("."+n,"").replace(r[0]+"-"+r[1]+"-","")),this.addNewItem(h,t[o].download_url,!0,m,!0,n,d,t[o].name,t[o].sha).then((()=>{l++,l==i&&(Q=!1,clearTimeout(H),P.log("updated"),e())}))})(o);if(!(R<=0))for(let e=0;e<R;e++)G.push({path:t[e].path,sha:null,mode:"100644",type:"blob"})})).catch((e=>{P.log(e),t(e)})))}))},uploadToGithub(){return new Promise(((e,t)=>{if(!this.shouldSync())return void e();if(M)return P.log("still uploading..."),void e();M=!0,V=setTimeout((()=>{M=!1}),12e4);let i=[];for(let o=0;o<this.items.length;o++)this.items[o].uploaded||(i.push(this.items[o]),this.setItemUploaded(o));if(i.length<=0){if(G.length<=0)return P.log("no item to upload"),M=!1,clearTimeout(V),void e();{P.log(this.$t("uploading"));let i=G;this.uploadTree(G).then((()=>{P.log(this.$t("uploaded")),G=G.filter((e=>!i.includes(e))),M=!1,clearTimeout(V),e()})).catch((e=>{P.log(e),this.$q.notify(this.$t("error")),M=!1,clearTimeout(V),t(e)}))}}else{P.log("uploading");let o=0;for(var l=0;l<i.length;l++)(l=>{let a=this.getItemPath(i[l]),s=i[l].value;switch(i[l].type){case"text":case"html":break;default:s=A.from(s,"base64");break}this.$githubInstance.githubRepo.createBlob(s).then((({data:l})=>{G.push({sha:l.sha,path:a,mode:"100644",type:"blob"}),o++,o==i.length&&this.uploadTree(G).then((()=>{P.log("uploaded"),G=[],M=!1,clearTimeout(V),e()})).catch((e=>{P.log(e),this.$q.notify(this.$t("error")),M=!1,clearTimeout(V),t(e)}))})).catch((e=>{P.log(e),this.$q.notify(this.$t("error")),M=!1,clearTimeout(V),t(e)}))})(l)}}))},uploadTree(e){return new Promise(((t,i)=>{if(e.length<1)return void t();let l;this.getSha().then((e=>{l=e})).then((()=>this.$githubInstance.githubRepo.createTree(e,l.commit))).then((({data:e})=>this.$githubInstance.githubRepo.commit(l.parent,e.sha,"update"))).then((({data:e})=>{this.$githubInstance.githubRepo.updateHead("heads/main",e.sha,!0)})).then((()=>{t()})).catch((e=>{P.log(e),i(e)}))}))},getSha(){return new Promise(((e,t)=>{let i,l;this.$githubInstance.githubRepo.getRef("heads/main").then((({data:e})=>{i=e.object.sha})).then((()=>this.$githubInstance.githubRepo.getCommit(i))).then((({data:t})=>(l=t.tree.sha,e({parent:i,commit:l})))).catch((e=>t(e)))}))},resetTimer(){L.forEach(((e,t)=>{clearInterval(e)})),L=[];const e=setInterval(this.checkClipboard,$.Z.checkClipboardInterval),t=setInterval(this.syncNow,$.Z.autoSyncInterval);L.push(e),L.push(t)},syncNow(e){this.$githubInstance.githubRepoExist?this.updateFromGithub().then((()=>{this.uploadToGithub(),setTimeout(e,1e3)})).catch((e=>{P.log(e)})):this.$router.push("/settings")},setupOpenwith(){cordova.openwith.init((()=>{cordova.openwith.addHandler((e=>{for(var t=0;t<e.items.length;++t){var i=e.items[t];cordova.openwith.load(i,((e,t)=>{cordova.plugins.clipboard.copy("");var i=t.path;window.resolveLocalFileSystemURL("file://"+i,(l=>{l.getMetadata((l=>{let o=l.size/1024/1024;if(o>this.maxFileSize)this.$q.notify(this.$t("maxFileSizeTip2"));else if(null!=t.type){const l=W.getExtension(t.type);if(l){i=i.split("/");var a=i[i.length-1],s=a.split("."),n=a.replace("."+s[s.length-1],"");this.addNewItem(null,e,!0,null,!1,l,n,null,null,!0)}}else this.$q.notify(this.$t("fileTypeNotSupported"))}))}))}))}})),U=!0}),(()=>{P.log("openwith plugin init failed")}))},addNewItem(e,t,i,l,o,a,s,n,r,h=!1){return new Promise(((h,m)=>{if(null==l&&(l=z.hash(t)),null!=this.lastNonShareItem&&this.lastNonShareItem.md5==l)return void h();null==e&&(e=(new Date).getTime());let d=this.items.findIndex((e=>e.md5==l));if(d<0)if(null!=r)if(["text","html"].concat($.Z.imageExt).concat($.Z.videoExt).concat($.Z.audioExt).concat($.Z.textExt).includes(a)){let t="html"==a||"text"==a;this.$githubInstance.githubRepo.getBlob(r,t).then((({data:t})=>{let i="html"==a||"text"==a?t:t.content;this.addItem({time:e,value:i,isBuffer:!0,md5:l,uploaded:o,type:a,fileName:s,remotePath:n,remoteSha:r}),h()}))}else this.addItem({time:e,value:t,isBuffer:!1,md5:l,uploaded:o,type:a,fileName:s,remotePath:n,remoteSha:r}),h();else this.addItem({time:e,value:t,isBuffer:i,md5:l,uploaded:o,type:a,fileName:s,remotePath:n,remoteSha:r}),h();else if(this.items[d].time==e)this.updateRemoteParam({index:d,value:t,remotePath:n,remoteSha:r}),h();else if(this.items[d].time>e)G.push({path:n,sha:null,mode:"100644",type:"blob"}),h();else{let o=this.items[d];if(this.removeItem(d),null!=o.remotePath){let n=this.getItemPath({time:e,md5:l,fileName:s,type:a});G.push({path:n,sha:o.remoteSha,mode:"100644",type:"blob"}),G.push({path:o.remotePath,sha:null,mode:"100644",type:"blob"}),this.addItem({time:e,value:t,isBuffer:i,md5:l,uploaded:!0,type:a,fileName:s,remotePath:n,remoteSha:o.remoteSha}),h()}else this.addItem({time:e,value:t,isBuffer:i,md5:l,uploaded:!1,type:a,fileName:s,remotePath:null,remoteSha:null}),h()}}))},getItemPath(e){let t=e.time.toString()+"-"+e.md5;return null!=e.fileName&&(t+="-"+e.fileName),null!=e.type&&(t+="."+e.type),t},deleteSelected(e=!0){if(this.toDeleteItems.length>0){if(e&&this.$q.notify(this.$t("deleting")),M)return void setTimeout((()=>{this.deleteSelected(!1)}),1e3);this.toDeleteItems.sort((function(e,t){return e-t}));for(let e=0;e<this.toDeleteItems.length;e++)this.items[this.toDeleteItems[e]].uploaded&&G.push({sha:null,path:this.getItemPath(this.items[this.toDeleteItems[e]]),mode:"100644",type:"blob"});if(G.length>0)M=!0,this.uploadTree(G).then((()=>{for(let e=this.toDeleteItems.length-1;e>=0;e--)F.push(this.items[this.toDeleteItems[e]].md5),this.removeItem(this.toDeleteItems[e]);G=[],M=!1,this.toDeleteItems=[],this.$q.notify(this.$t("deleted"))})).catch((e=>{P.log(e),G=[],M=!1,this.$q.notify(this.$t("error"))}));else{for(let e=this.toDeleteItems.length-1;e>=0;e--)F.push(this.items[this.toDeleteItems[e]].md5),this.removeItem(this.toDeleteItems[e]);this.toDeleteItems=[],this.$q.notify(this.$t("deleted"))}}this.actionBtn=!1,this.isAllSelected=!1},selectAll(){if(this.toDeleteItems=[],!0===this.isAllSelected)for(let e=0;e<this.items.length;e++)this.toDeleteItems.push(e)},initGithub(){this.$q.localStorage.has("clipbroad-github-token")&&(this.$q.notify(this.$t("connectingGithub")),this.$setGithub(this.$q.localStorage.getItem("clipbroad-github-token")).then((({data:e})=>{this.$q.notify(this.$t("connectedGithub")),this.$q.notify(this.$t("updating")),this.updateFromGithub().then((()=>{this.$q.notify(this.$t("updated")),this.resetTimer()}))})).catch((()=>{this.$q.notify(this.$t("error")),setTimeout((()=>{this.initGithub()}),2e3)})))},getTextFromHtml(e){var t=document.createElement("div");t.innerHTML=e;var i=t.textContent||t.innerText||"";return t.remove(),i},getSearchContent(e){var t="";return e in this.items&&(null!=this.items[e].type&&(t+="."+this.items[e].type),null!=this.items[e].fileName&&(t+=this.items[e].fileName),"text"==this.items[e].type&&(t+=this.items[e].value),"html"==this.items[e].type&&(t+=this.getTextFromHtml(this.items[e].value)),$.Z.textExt.includes(this.items[e].type)&&(t+=A.from(this.items[e].value,"base64").toString("utf-8"))),t}}),mounted(){this.initGithub(),this.$q.platform.is.electron&&this.$nextTick((()=>{this.$refs.searchInput.focus()}))},created(){if(this.$i18n.locale=this.$q.lang.getLocale(),this.setDarkMode(),this.$q.platform.is.electron){let e=this.$q.localStorage.has("clipbroad-shortcut")?this.$q.localStorage.getItem("clipbroad-shortcut"):$.Z.defaultSettings.shortcut;window.myAPI.registerShortcut(JSON.stringify(e));let t=this.$q.localStorage.has("clipbroad-hide-icon")?this.$q.localStorage.getItem("clipbroad-hide-icon"):$.Z.defaultSettings.hideIcon;window.myAPI.setHideIcon(t)}B||(window.addEventListener("Sync",this.syncNow,!1),window.addEventListener("setDarkMode",this.setDarkMode,!1),B=!0),this.$q.platform.is.cordova&&(U||this.setupOpenwith())}});var Y=i(4379),J=i(151),K=i(4842),X=i(4554),ee=i(3414),te=i(9754),ie=i(9297),le=i(7011),oe=i(8870),ae=i(5735),se=i(9570),ne=i(4607),re=i(6489),he=i(7281);O.render=f;const me=O;Z()(O,"components",{QPage:Y.Z,QCard:J.Z,QInput:K.Z,QIcon:X.Z,QItem:ee.Z,QSpinner:te.Z,QPullToRefresh:ie.Z,QList:le.Z,QTooltip:oe.Z,QItemSection:N.Z,QCheckbox:ae.Z,QItemLabel:T.Z,QToolbar:se.Z,QBtn:ne.Z}),Z()(O,"directives",{Ripple:re.Z,TouchHold:he.Z})}}]);